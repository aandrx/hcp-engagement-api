# 🚀 Deploy HCP Engagement API to Render

This guide provides step-by-step instructions to deploy your Groq-powered HCP Engagement API to Render's free tier.

## 📋 Prerequisites

- ✅ GitHub account with this repository
- ✅ Render account (sign up at [render.com](https://render.com))
- ✅ Groq API key (get at [console.groq.com](https://console.groq.com))

## 🎯 Quick Deploy (Recommended)

### Option 1: Deploy with render.yaml (Automated)

1. **Fork/Clone this repository** to your GitHub account

2. **Get your Groq API key**:
   - Visit [console.groq.com](https://console.groq.com)
   - Sign up for free account
   - Create API key and copy it

3. **Deploy to Render**:
   - Go to [render.com](https://render.com) and sign in
   - Click **"New +"** → **"Web Service"**
   - Connect your GitHub account
   - Select this repository
   - Render will automatically detect `render.yaml` and configure the service

4. **Set Environment Variables**:
   - In Render dashboard, go to **Environment** tab
   - Add required variables:
     ```
     GROQ_API_KEY=your-groq-api-key-here
     FLASK_ENV=production
     ```
   - SECRET_KEY and JWT_SECRET_KEY will be auto-generated

5. **Deploy**:
   - Click **"Create Web Service"**
   - Wait for deployment to complete (~5-10 minutes)
   - Your API will be live at: `https://your-service-name.onrender.com`

### Option 2: Manual Configuration

If you prefer manual setup:

1. **Create Web Service**:
   - New → Web Service
   - Connect GitHub repo
   - Configure manually:
     - **Name**: `hcp-engagement-api` (or your choice)
     - **Environment**: `Python 3`
     - **Build Command**: `pip install -r requirements.txt`
     - **Start Command**: `gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120`

2. **Set Environment Variables** (same as Option 1)

3. **Deploy and wait for completion**

## 🔧 Environment Variables Setup

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `GROQ_API_KEY` | ✅ Required | Your Groq API key for AI features | `gsk_abc123...` |
| `FLASK_ENV` | ✅ Required | Set to production | `production` |
| `SECRET_KEY` | ⚙️ Auto-generated | Flask secret key | Auto-generated by Render |
| `JWT_SECRET_KEY` | ⚙️ Auto-generated | JWT signing key | Auto-generated by Render |
| `REDIS_URL` | ❌ Optional | Redis for caching | `redis://...` |

## ✅ Verification Steps

After deployment, verify everything works:

### 1. Check Service Health
```bash
curl https://your-service-name.onrender.com/health
```

Expected response:
```json
{
  "status": "healthy",
  "version": "2.2",
  "services": {
    "authentication": "active",
    "literature_search": "active",
    "ai_analysis": "active"
  },
  "groq_integration": {
    "available": true,
    "models_available": ["llama-3.1-8b-instant", "mixtral-8x7b-32768"]
  }
}
```

### 2. Test Authentication
```bash
curl -X POST https://your-service-name.onrender.com/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "demo_provider", "password": "demo123"}'
```

### 3. Test Literature Search
```bash
# First get auth token from step 2, then:
curl -X POST https://your-service-name.onrender.com/literature/search \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "specialty": "Cardiology",
    "keywords": ["heart failure"],
    "max_results": 3,
    "enable_ai_analysis": true
  }'
```

## 📊 Monitoring

Your deployment includes automated monitoring:

- **GitHub Actions**: Checks API health every 30 minutes
- **Health Endpoint**: `/health` provides real-time status
- **Render Dashboard**: Shows deployment logs and metrics

## 🔄 Automatic Deployments

- ✅ **Auto-deploy enabled**: Every push to `main` branch triggers deployment
- ✅ **Health checks**: Render monitors `/health` endpoint
- ✅ **Rollback**: Automatic rollback if deployment fails

## 🎉 API Endpoints

Once deployed, your API provides these endpoints:

### Authentication
- `POST /auth/login` - User authentication

### Literature & AI Analysis  
- `POST /literature/search` - AI-powered literature search
- `POST /ai/analyze` - General AI text analysis
- `GET /ai/models` - Available AI models

### Healthcare Analytics
- `POST /analytics/predict-risk` - Patient risk prediction
- `POST /analytics/predict-cost` - Treatment cost estimation
- `POST /analytics/population-trends` - Population health analysis

### Documentation
- `GET /docs/` - Interactive API documentation
- `GET /health` - Service health check

## 🐛 Troubleshooting

### Common Issues:

**"Build failed"**
- Check that `requirements.txt` includes all dependencies
- Verify Python version compatibility

**"Service unhealthy"**
- Check environment variables are set correctly
- Verify GROQ_API_KEY is valid
- Review deployment logs in Render dashboard

**"Groq features not working"**
- Ensure GROQ_API_KEY is set in environment variables
- Check API key quota at console.groq.com
- Verify key has correct permissions

**"Authentication errors"**
- SECRET_KEY and JWT_SECRET_KEY should be auto-generated
- If manually set, ensure they're long random strings (32+ chars)

### Getting Help:

1. **Check Render Logs**: Go to Render dashboard → your service → Logs
2. **Test Health Endpoint**: Visit `https://your-service.onrender.com/health`
3. **GitHub Actions**: Check workflow runs for monitoring status
4. **API Documentation**: Visit `https://your-service.onrender.com/docs/`

## 🎊 Success!

Your HCP Engagement API is now live! 🎉

- **API URL**: `https://your-service-name.onrender.com`
- **Documentation**: `https://your-service-name.onrender.com/docs/`
- **Health Check**: `https://your-service-name.onrender.com/health`

The API features:
- 🤖 **AI-Powered Literature Analysis** via Groq
- 🔐 **Secure Authentication** with JWT
- 📊 **Healthcare Analytics** and risk prediction  
- 📚 **PubMed Integration** for medical research
- 🌐 **RESTful API** with comprehensive documentation
- 📈 **Real-time Monitoring** and health checks

## 💡 Next Steps

- **Custom Domain**: Add your domain in Render dashboard
- **SSL Certificate**: Automatically provided by Render
- **Scaling**: Upgrade to paid tier for better performance
- **Monitoring**: Set up alerts for service health
- **CI/CD**: Customize GitHub Actions for your workflow

---

**Need help?** Check the logs in your Render dashboard or review the troubleshooting section above.
